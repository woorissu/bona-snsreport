<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>보나팩토리 월간 SNS콘텐츠 리포트 - 넥스트피닉스</title>
  
  <!-- Chart.js & Papa Parse (CSV 안전 파싱) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  
  <style>
    :root {
      /* Light theme colors - 무채색 베이스 */
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #f1f3f4;
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --text-tertiary: #80868b;
      --border-light: #e8eaed;
      --border-medium: #dadce0;
      --card-bg: #ffffff;
      --shadow: 0 1px 3px rgba(60, 64, 67, 0.15);
      --shadow-lg: 0 4px 16px rgba(60, 64, 67, 0.15);
      
      /* Platform colors */
      --blog-color: #2ecc71;
      --blog-light: #e8f5e8;
      --instagram-color: #e91e63;
      --instagram-light: #fce4ec;
      --facebook-color: #3498db;
      --facebook-light: #e3f2fd;
      
      color-scheme: light;
    }

    [data-theme="dark"] {
      /* Dark theme colors - 무채색 베이스 */
      --bg-primary: #1f1f1f;
      --bg-secondary: #2d2d2d;
      --bg-tertiary: #3c3c3c;
      --text-primary: #e8eaed;
      --text-secondary: #bdc1c6;
      --text-tertiary: #9aa0a6;
      --border-light: #3c4043;
      --border-medium: #5f6368;
      --card-bg: #292a2d;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.3);
      
      color-scheme: dark;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      line-height: 1.6;
      transition: all 0.2s ease;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }

    header {
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-left { flex: 1; min-width: 300px; }

    h1 { font-size: clamp(20px, 4vw, 28px); font-weight: 700; color: var(--text-primary); margin-bottom: 8px; }

    .header-badges { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 8px; }

    .pill {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .theme-toggle {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .theme-toggle:hover { background: var(--text-primary); color: var(--card-bg); }

    /* 필터 및 탭 */
    .controls {
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
    }

    .filter-row { display: flex; gap: 16px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }

    .filter-group { display: flex; align-items: center; gap: 8px; }
    .filter-group label { font-size: 14px; font-weight: 500; color: var(--text-secondary); min-width: auto; margin-right: 4px; }

    .filter-select, .search-input {
      background: var(--bg-secondary);
      border: 1px solid var(--border-medium);
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 14px;
      color: var(--text-primary);
      min-width: 120px;
    }
    .search-input { min-width: 200px; }

    .tabs { display: flex; gap: 4px; background: var(--bg-secondary); border-radius: 8px; padding: 4px; }
    .tab {
      background: transparent; border: none; border-radius: 6px; padding: 8px 16px;
      font-size: 14px; font-weight: 500; color: var(--text-secondary); cursor: pointer;
      transition: all 0.2s ease; flex: 1; text-align: center;
    }
    .tab.active { background: var(--card-bg); color: var(--text-primary); box-shadow: var(--shadow); }
    .tab.blog.active { color: var(--blog-color); border: 1px solid var(--blog-color); }
    .tab.instagram.active { color: var(--instagram-color); border: 1px solid var(--instagram-color); }
    .tab.facebook.active { color: var(--facebook-color); border: 1px solid var(--facebook-color); }

    .grid { display: grid; gap: 24px; grid-template-columns: 1fr; }
    .card { background: var(--card-bg); border: 1px solid var(--border-light); border-radius: 12px; padding: 24px; box-shadow: var(--shadow); transition: all 0.2s ease; }
    .card:hover { box-shadow: var(--shadow-lg); }
    .card h3 { font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }

    .list { display: flex; flex-direction: column; gap: 8px; }
    .week-title {
      font-weight: 600; font-size: 16px; margin: 16px 0 8px; padding: 12px 16px;
      background: var(--bg-secondary); border-radius: 8px; border-left: 3px solid var(--text-tertiary); color: var(--text-primary);
      border-bottom: 1px solid var(--border-light); /* ✅ 주차 블록 구분선 추가 */
    }

    .platform-group { margin-bottom: 20px; }
    .platform-header { font-weight: 600; font-size: 16px; margin-bottom: 12px; padding: 12px 16px; border-radius: 8px; color: white; display: flex; align-items: center; gap: 8px; }
    .platform-header.blog { background: var(--blog-color); }
    .platform-header.instagram { background: var(--instagram-color); }
    .platform-header.facebook { background: var(--facebook-color); }

    .item { padding: 12px 16px; border-radius: 8px; background: var(--bg-secondary); border: 1px solid var(--border-light); transition: all 0.2s ease; margin-left: 20px; }
    .item:hover { transform: translateX(4px); box-shadow: var(--shadow); }
    .item a { text-decoration: none; color: var(--text-primary); font-weight: 500; transition: color 0.2s ease; }
    .item a:hover { text-decoration: underline; }
    .item.blog a:hover { color: var(--blog-color); }
    .item.instagram a:hover { color: var(--instagram-color); }
    .item.facebook a:hover { color: var(--facebook-color); }

    /* ✅ 오늘 날짜 강조 */
    .item.today { 
      background: #e6f3ff; 
      border-color: #90caf9; 
      }
    /* ✅ 오늘 날짜 강조 (다크모드용) */
    [data-theme="dark"] .item.today {
      background: #2d3e50;   /* 진한 남색톤 */
      border-color: #64b5f6; /* 밝은 파랑 */
      }


    .meta { font-size: 12px; color: var(--text-tertiary); margin-top: 4px; display: flex; align-items: center; gap: 8px; }
    .platform-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }

    #platformChart { border-radius: 8px; }

    .empty-state { text-align: center; padding: 40px; color: var(--text-tertiary); }

    .stats-summary {
      background: var(--bg-secondary); border-radius: 8px; padding: 16px; margin-bottom: 20px;
      display: flex; justify-content: space-around; text-align: center;
    }
    .stat-item { flex: 1; }
    .stat-number { font-size: 24px; font-weight: 700; color: var(--text-primary); }
    .stat-label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }

    /* === 안내 문구, 바로가기 버튼 === */
    .notice { font-size: 14px; color: var(--text-tertiary); margin-top: 4px; }
    .link-buttons { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
    .btn-link {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 12px; border: 1px solid var(--border-light); border-radius: 8px;
      background: var(--card-bg); color: var(--text-primary); text-decoration: none;
      box-shadow: var(--shadow); font-size: 14px;
    }
    .btn-link:hover { transform: translateY(-1px); }
    .btn-blog { border-color: var(--blog-color); }
    .btn-instagram { border-color: var(--instagram-color); }
    .btn-facebook { border-color: var(--facebook-color); }

    /* ✅ 하단 로고 텍스트 */
    footer.brand-footer {
      text-align: center;
      margin: 40px 0 12px;
      font-size: 15pt;
      font-weight: 700;
      color: var(--text-secondary);
    }

    /* ✅ 푸터 */
  .footer {
    text-align: center;
    font-size: 20px;
    font-weight: 600;
    color: var(--text-tertiary);
    margin-top: 40px;   /* 본문과의 gap */
    padding: 20px 0;    /* 하단 여백 */
    border-top: 1px solid var(--border-light); /* 구분선 */
  }
  [data-theme="dark"] .footer {
    border-top: 2px solid var(--border-medium); /* 다크모드에서도 자연스럽게 */
  }
    
    
    /* Responsive */
    @media (min-width: 1024px) { .grid { grid-template-columns: 1.5fr 1fr; } }
    @media (max-width: 768px) {
      .container { padding: 16px; }
      header { flex-direction: column; align-items: stretch; text-align: center; }
      .filter-row { flex-direction: column; align-items: stretch; }
      .tabs { flex-direction: column; }
      .item:hover { transform: none; }
      .link-buttons { justify-content: center; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="header-left">
        <h1>보나팩토리 SNS 컨텐츠 제작대행 리포트</h1>

        <p class="notice">
          ※ 주 3회 이미지 콘텐츠 제작 <b>페이스북&인스타 미러링</b>  <br>
          ※ <b>브랜딩 블로그</b> 월 10회 발행 진행중 (상위노출 보장X) <br>
          (업체코드 Bona287 임대표님 직접담당업체)
        </p>

        <div class="header-badges">
          <span id="month" class="pill"></span>
          <span id="totals" class="pill"></span>
          <!-- ✅ 자동 업데이트 안내 -->
          <span id="updateTime" class="pill"></span>
        </div>
      </div>
      <button class="theme-toggle" id="themeToggle">
        <span id="theme-icon">🌙</span>
        <span id="theme-text">다크모드</span>
      </button>
    </header>

    <!-- 필터 및 탭 컨트롤 -->
    <div class="controls">
      <div class="filter-row">
        <div class="filter-group">
          <label>보기:</label>
          <select id="viewType" class="filter-select">
            <option value="week">주차별</option>
            <option value="month">월별</option>
          </select>
        </div>
        <div class="filter-group">
          <label>월:</label>
          <select id="monthFilter" class="filter-select">
            <option value="">전체</option>
          </select>
        </div>
        <div class="filter-group">
          <label>주차:</label>
          <select id="weekFilter" class="filter-select">
            <option value="">전체</option>
          </select>
        </div>

        <!-- 기간(달력) 필터 -->
        <div class="filter-group">
          <label>기간:</label>
          <input type="date" id="startDate" class="filter-select" />
          ~
          <input type="date" id="endDate" class="filter-select" />
        </div>

        <!-- ✅ 검색창 -->
        <div class="filter-group">
          <label>검색:</label>
          <input type="text" id="searchBox" class="search-input" placeholder="키워드 검색 (주제, 플랫폼)" />
        </div>
      </div>
      
      <div class="tabs">
        <button class="tab active" data-platform="all">📊 전체</button>
        <button class="tab blog" data-platform="블로그">블로그</button>
        <button class="tab instagram" data-platform="인스타">인스타그램</button>
        <button class="tab facebook" data-platform="페북">페이스북</button>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <h3 id="contentTitle">📝 전체 게시물</h3>
        <div id="statsSummary" class="stats-summary" style="display: none;"></div>
        <div id="weeks" class="list"></div>
      </section>

      <section class="card">
        <h3>📊 플랫폼별 집계</h3>
        <canvas id="platformChart" height="240"></canvas>

        <!-- 플랫폼 바로가기 버튼 -->
        <div class="link-buttons">
          <a id="btnBlog" class="btn-link btn-blog" href="#" target="_blank" rel="noopener">📝 블로그 바로가기</a>
          <a id="btnInsta" class="btn-link btn-instagram" href="#" target="_blank" rel="noopener">📷 인스타 바로가기</a>
          <a id="btnFb"   class="btn-link btn-facebook" href="#" target="_blank" rel="noopener">👥 페이스북 바로가기</a>
        </div>

      </section>
    </div>
  </div>

  <!-- ✅ 하단 로고 텍스트 -->
  <!-- ✅ 하단 푸터 -->
<footer class="footer">
  <a href="https://nextphoenix.co.kr" target="_blank" rel="noopener" style="text-decoration:none; color:inherit;">
    넥스트피닉스
  </a>
</footer>


  <script>
    // ===== 설정 =====
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQAZld2-FLleV-GvqjIma-51hpcVmperjx7LlAd79BnN-8Z7-NAoakyf3KVEqeYcaK6Ev83IMc6K7_v/pub?gid=0&single=true&output=csv';
    const COLORS = { '블로그':'#2ecc71', '인스타':'#e91e63', '페북':'#3498db' };

    // ===== 전역 상태 =====
    let allData = [];
    let filteredData = [];
    let currentPlatform = 'all';
    let currentViewType = 'week';
    let chartInstance = null;
    let QUICK_LINKS = { blog:'#', instagram:'#', facebook:'#' };

    // ===== 유틸 =====
    function weekOf(dateStr){
      const d = new Date(dateStr);
      const first = new Date(d.getFullYear(), d.getMonth(), 1);
      const diff = Math.floor((d - first)/(1000*60*60*24));
      return Math.floor(diff/7) + 1;
    }
    function todayYMD(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${dd}`;
    }
    const TODAY = todayYMD();

    function groupByWeek(items){
      const map = {};
      items.forEach(it=>{
        const w = weekOf(it.date);
        (map[w] ||= []).push(it);
      });
      return Object.entries(map)
        .sort((a,b)=>a[0]-b[0])
        .map(([w, arr])=>[Number(w), arr.sort((a,b)=>a.date.localeCompare(b.date))]);
    }

    function groupByMonth(items) {
      const map = {};
      items.forEach(item => {
        const month = item.date.slice(0, 7); // YYYY-MM
        (map[month] ||= []).push(item);
      });
      return Object.entries(map).sort((a,b) => a[0].localeCompare(b[0]));
    }

    function calculateCounts(data) {
      const counts = data.reduce((acc, item) => {
        const key = item.platform === '블로그' ? 'blog' : 
                   item.platform === '인스타' ? 'instagram' : 'facebook';
        acc[key] = (acc[key] || 0) + 1;
        return acc;
      }, {});
      return { blog: counts.blog || 0, instagram: counts.instagram || 0, facebook: counts.facebook || 0 };
    }

    // ===== 데이터 로드 =====
    async function fetchRows() {
      const url = CSV_URL + `&cachebust=${Date.now()}`;
      const res = await fetch(url, { cache: 'no-store' });
      const text = await res.text();
      const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
      return parsed.data
        .map(r => ({
          date: (r['업로드날짜'] || '').trim(),
          platform: (r['플랫폼'] || '').trim(), // '블로그'/'인스타'/'페북'
          title: (r['주제'] || '').trim(),
          url: (r['링크'] || '').trim()
        }))
        .filter(x => x.title && x.url && x.date);
    }
    
    // CSV E열(0-index 4) 2~4행(0-index 1..3)에서 바로가기 링크를 읽는다.
    async function fetchQuickLinks() {
      const url = CSV_URL + `&cachebust=${Date.now()}`;
      const res = await fetch(url, { cache: 'no-store' });
      const text = await res.text();

      // 헤더 없이 파싱해서 행/열로 직접 접근
      const raw = Papa.parse(text, { header: false, skipEmptyLines: true }).data;

      const blog   = (raw[1] && raw[1][4]) ? String(raw[1][4]).trim() : '#'; // E2
      const insta  = (raw[2] && raw[2][4]) ? String(raw[2][4]).trim() : '#'; // E3
      const fb     = (raw[3] && raw[3][4]) ? String(raw[3][4]).trim() : '#'; // E4

      QUICK_LINKS = { blog, instagram: insta, facebook: fb };

      // 버튼 href 주입
      const btnBlog = document.getElementById('btnBlog');
      const btnInsta = document.getElementById('btnInsta');
      const btnFb = document.getElementById('btnFb');
      if (btnBlog) btnBlog.href = QUICK_LINKS.blog || '#';
      if (btnInsta) btnInsta.href = QUICK_LINKS.instagram || '#';
      if (btnFb) btnFb.href = QUICK_LINKS.facebook || '#';
    }

    // ===== 렌더링 =====
    function renderList(grouped){
      const root = document.getElementById('weeks');
      root.innerHTML = '';
      if (grouped.length === 0) {
        root.innerHTML = '<div class="empty-state">선택한 조건에 맞는 게시물이 없습니다.</div>';
        return;
      }
      grouped.forEach(([week, arr])=>{
        const title = document.createElement('div');
        title.className = 'week-title';
        const counts = arr.reduce((acc,it)=>{ acc[it.platform]=(acc[it.platform]||0)+1; return acc; },{});
        title.textContent = `${week}주차 (${arr.length}건 / 블 ${counts['블로그']||0} · 인 ${counts['인스타']||0} · 페 ${counts['페북']||0})`;
        root.appendChild(title);

        arr.forEach(it=>{
          const row = document.createElement('div');
          const cls = it.platform === '블로그' ? 'blog' : it.platform === '인스타' ? 'instagram' : 'facebook';
          const color = COLORS[it.platform] || '#666';
          row.className = `item ${cls}` + (it.date === TODAY ? ' today' : ''); // ✅ 오늘 표시
          row.innerHTML = `
            <div>
              <span class="platform-dot" style="background:${color};"></span>
              <a href="${it.url}" target="_blank" rel="noopener">${it.title}</a>
            </div>
            <div class="meta">${it.date} · ${week}주차 · ${it.platform}</div>
          `;
          root.appendChild(row);
        });
      });
    }

    function renderListByPlatform(grouped) {
      const root = document.getElementById('weeks');
      root.innerHTML = '';
      if (grouped.length === 0) {
        root.innerHTML = '<div class="empty-state">선택한 조건에 맞는 게시물이 없습니다.</div>';
        return;
      }
      const platformGroups = { '블로그': [], '인스타': [], '페북': [] };
      grouped.forEach(([week, arr])=>{
        arr.forEach(item => {
          platformGroups[item.platform]?.push({ ...item, week });
        });
      });

      Object.entries(platformGroups).forEach(([platform, items])=>{
        if (!items.length) return;
        const platformClass = platform === '블로그' ? 'blog' : platform === '인스타' ? 'instagram' : 'facebook';
        const platformIcon = platform === '블로그' ? '📝' : platform === '인스타' ? '📷' : '👥';
        const color = COLORS[platform] || '#666';

        const container = document.createElement('div');
        container.className = 'platform-group';
        container.innerHTML = `<div class="platform-header ${platformClass}">${platformIcon} ${platform} (${items.length}건)</div>`;
        items.sort((a,b)=>a.date.localeCompare(b.date));
        items.forEach(item=>{
          const row = document.createElement('div');
          row.className = `item ${platformClass}` + (item.date === TODAY ? ' today' : ''); // ✅ 오늘 표시
          row.innerHTML = `
            <div>
              <span class="platform-dot" style="background:${color};"></span>
              <a href="${item.url}" target="_blank" rel="noopener">${item.title}</a>
            </div>
            <div class="meta">${item.date} · ${item.week}주차</div>
          `;
          container.appendChild(row);
        });
        root.appendChild(container);
      });
    }

    function renderMonthList(grouped) {
      const root = document.getElementById('weeks');
      root.innerHTML = '';
      if (grouped.length === 0) {
        root.innerHTML = '<div class="empty-state">선택한 조건에 맞는 게시물이 없습니다.</div>';
        return;
      }
      grouped.forEach(([month, arr])=>{
        const title = document.createElement('div');
        title.className = 'week-title';
        title.textContent = `${month} (${arr.length}건)`;
        root.appendChild(title);

        arr.sort((a,b)=>a.date.localeCompare(b.date));
        arr.forEach(item=>{
          const color = COLORS[item.platform] || '#666';
          const cls = item.platform === '블로그' ? 'blog' : item.platform === '인스타' ? 'instagram' : 'facebook';
          const row = document.createElement('div');
          row.className = `item ${cls}` + (item.date === TODAY ? ' today' : ''); // ✅ 오늘 표시
          row.innerHTML = `
            <div>
              <span class="platform-dot" style="background:${color};"></span>
              <a href="${item.url}" target="_blank" rel="noopener">${item.title}</a>
            </div>
            <div class="meta">${item.date} · ${item.platform}</div>
          `;
          root.appendChild(row);
        });
      });
    }

    // 상단 요약/배지, 차트
    function renderTotals(items){
      const counts = items.reduce((acc, it)=>{
        acc[it.platform] = (acc[it.platform]||0)+1;
        return acc;
      }, {});
      const blog = counts['블로그']||0, insta = counts['인스타']||0, fb = counts['페북']||0;
      document.getElementById('totals').textContent = `총 ${blog+insta+fb}건`;

      const m = items.map(x=> (x.date||'').slice(0,7)).filter(Boolean).sort().pop();
      document.getElementById('month').textContent = m || '';

      // 통계 카드 (전체 탭일 때만)
      const stats = document.getElementById('statsSummary');
      if (currentPlatform === 'all' && (blog+insta+fb)>0) {
        stats.style.display = 'flex';
        stats.innerHTML = `
          <div class="stat-item"><div class="stat-number" style="color: var(--blog-color)">${blog}</div><div class="stat-label">블로그</div></div>
          <div class="stat-item"><div class="stat-number" style="color: var(--instagram-color)">${insta}</div><div class="stat-label">인스타그램</div></div>
          <div class="stat-item"><div class="stat-number" style="color: var(--facebook-color)">${fb}</div><div class="stat-label">페이스북</div></div>
        `;
      } else {
        stats.style.display = 'none';
      }
      return { blog, instagram: insta, facebook: fb };
    }

    function renderChart(counts){
      const ctx = document.getElementById('platformChart');
      const labels = ['블로그','인스타','페북'];
      const data = [counts.blog||0, counts.instagram||0, counts.facebook||0];
      const bg = ['#2ecc71','#e91e63','#3498db']; // ✅ 플랫폼별 색

      if (chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx, {
        type: 'bar',
        data: { 
          labels, 
          datasets: [{ 
            label:'게시물 수', 
            data, 
            backgroundColor: bg 
          }] 
        },
        options: { 
          responsive:true, 
          plugins:{legend:{display:false}}, 
          scales:{y:{beginAtZero:true, ticks:{precision:0}}} 
        }
      });
    }


    // ===== 필터/탭/테마 =====
    function updateFilterOptions(data) {
      const months = [...new Set(data.map(item => item.date.slice(0, 7)))].sort();
      const monthSelect = document.getElementById('monthFilter');
      monthSelect.innerHTML = '<option value="">전체</option>';
      months.forEach(month => monthSelect.innerHTML += `<option value="${month}">${month}</option>`);
      const weeks = [...new Set(data.map(item => weekOf(item.date)))].sort((a,b)=>a-b);
      const weekSelect = document.getElementById('weekFilter');
      weekSelect.innerHTML = '<option value="">전체</option>';
      weeks.forEach(week => weekSelect.innerHTML += `<option value="${week}">${week}주차</option>`);
    }

    function applyFilters() {
      currentViewType = document.getElementById('viewType').value;
      const selectedMonth = document.getElementById('monthFilter').value;
      const selectedWeek = document.getElementById('weekFilter').value;

      // 날짜 범위 값
      const start = document.getElementById('startDate').value; // YYYY-MM-DD
      const end   = document.getElementById('endDate').value;   // YYYY-MM-DD

      // ✅ 검색어
      const keyword = (document.getElementById('searchBox').value || '').trim().toLowerCase();

      let data = (currentPlatform === 'all') ? [...allData] : allData.filter(d => d.platform === currentPlatform);
      if (selectedMonth) data = data.filter(d => d.date.startsWith(selectedMonth));
      if (selectedWeek)  data = data.filter(d => weekOf(d.date) == selectedWeek);

      // 날짜 범위 필터 (YYYY-MM-DD 문자열 비교)
      if (start) data = data.filter(d => d.date >= start);
      if (end)   data = data.filter(d => d.date <= end);

      // ✅ 키워드 필터 (주제/플랫폼/URL)
      if (keyword) {
        data = data.filter(d => 
          (d.title || '').toLowerCase().includes(keyword) ||
          (d.platform || '').toLowerCase().includes(keyword) ||
          (d.url || '').toLowerCase().includes(keyword)
        );
      }

      filteredData = data;

      if (currentViewType === 'week') {
        if (currentPlatform === 'all') renderList(groupByWeek(data));
        else renderListByPlatform(groupByWeek(data));
      } else {
        const grouped = groupByMonth(data);
        renderMonthList(grouped);
      }

      const counts = renderTotals(data);
      renderChart(counts);
    }

    function switchPlatform(platform, buttonEl) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      buttonEl.classList.add('active');
      currentPlatform = platform;
      const titleMap = { 'all':'📊 전체', '블로그':'📝 블로그', '인스타':'📷 인스타그램', '페북':'👥 페이스북' };
      document.getElementById('contentTitle').textContent = `${titleMap[platform]} 게시물`;
      applyFilters();
    }

    function bindUI() {
      // 테마 토글
      const toggleBtn = document.getElementById('themeToggle');
      toggleBtn.addEventListener('click', ()=>{
        const body = document.body;
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');
        if (body.getAttribute('data-theme') === 'dark') {
          body.removeAttribute('data-theme'); themeIcon.textContent = '🌙'; themeText.textContent = '다크모드'; localStorage.setItem('theme','light');
        } else {
          body.setAttribute('data-theme','dark'); themeIcon.textContent = '☀️'; themeText.textContent = '라이트모드'; localStorage.setItem('theme','dark');
        }
        if (chartInstance) { chartInstance.destroy(); renderChart(calculateCounts(filteredData)); }
      });

      // 저장된 테마 복원
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') {
        document.body.setAttribute('data-theme','dark');
        document.getElementById('theme-icon').textContent = '☀️';
        document.getElementById('theme-text').textContent = '라이트모드';
      }

      // 셀렉트/입력 변경
      document.getElementById('viewType').addEventListener('change', applyFilters);
      document.getElementById('monthFilter').addEventListener('change', applyFilters);
      document.getElementById('weekFilter').addEventListener('change', applyFilters);
      document.getElementById('startDate').addEventListener('change', applyFilters);
      document.getElementById('endDate').addEventListener('change', applyFilters);
      document.getElementById('searchBox').addEventListener('input', applyFilters);

      // 탭
      document.querySelectorAll('.tab').forEach(btn=>{
        btn.addEventListener('click', ()=> switchPlatform(btn.dataset.platform, btn));
      });
    }

    function setUpdateTime(){
      const el = document.getElementById('updateTime');
      if (el) el.textContent = '업데이트: ' + new Date().toLocaleString('ko-KR');
    }

    // ===== 부트스트랩 =====
    (async ()=>{
      bindUI();
      allData = await fetchRows();
      await fetchQuickLinks();          // CSV E2~E4 링크 읽어와 버튼에 주입
      updateFilterOptions(allData);
      setUpdateTime();                  // ✅ 자동 업데이트 표시
      applyFilters();                   // 초기 렌더
    })();

    
  </script>
</body>
</html>
