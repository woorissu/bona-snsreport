<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë³´ë‚˜íŒ©í† ë¦¬ ì›”ê°„ SNSì½˜í…ì¸  ë¦¬í¬íŠ¸ - ë„¥ìŠ¤íŠ¸í”¼ë‹‰ìŠ¤</title>
  
  <!-- Chart.js & Papa Parse (CSV ì•ˆì „ íŒŒì‹±) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  
  <style>
    :root {
      /* Light theme colors - ë¬´ì±„ìƒ‰ ë² ì´ìŠ¤ */
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #f1f3f4;
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --text-tertiary: #80868b;
      --border-light: #e8eaed;
      --border-medium: #dadce0;
      --card-bg: #ffffff;
      --shadow: 0 1px 3px rgba(60, 64, 67, 0.15);
      --shadow-lg: 0 4px 16px rgba(60, 64, 67, 0.15);
      
      /* Platform colors */
      --blog-color: #2ecc71;
      --blog-light: #e8f5e8;
      --instagram-color: #e91e63;
      --instagram-light: #fce4ec;
      --facebook-color: #3498db;
      --facebook-light: #e3f2fd;
      
      color-scheme: light;
    }

    [data-theme="dark"] {
      /* Dark theme colors - ë¬´ì±„ìƒ‰ ë² ì´ìŠ¤ */
      --bg-primary: #1f1f1f;
      --bg-secondary: #2d2d2d;
      --bg-tertiary: #3c3c3c;
      --text-primary: #e8eaed;
      --text-secondary: #bdc1c6;
      --text-tertiary: #9aa0a6;
      --border-light: #3c4043;
      --border-medium: #5f6368;
      --card-bg: #292a2d;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.3);
      
      color-scheme: dark;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      line-height: 1.6;
      transition: all 0.2s ease;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }

    header {
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-left { flex: 1; min-width: 300px; }

    h1 { font-size: clamp(20px, 4vw, 28px); font-weight: 700; color: var(--text-primary); margin-bottom: 8px; }

    .header-badges { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 8px; }

    .pill {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .theme-toggle {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .theme-toggle:hover { background: var(--text-primary); color: var(--card-bg); }

    /* í•„í„° ë° íƒ­ */
    .controls {
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
    }

    .filter-row { display: flex; gap: 16px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }

    .filter-group { display: flex; align-items: center; gap: 8px; }
    .filter-group label { font-size: 14px; font-weight: 500; color: var(--text-secondary); min-width: auto; margin-right: 4px; }

    .filter-select, .search-input {
      background: var(--bg-secondary);
      border: 1px solid var(--border-medium);
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 14px;
      color: var(--text-primary);
      min-width: 120px;
    }
    .search-input { min-width: 200px; }

    .tabs { display: flex; gap: 4px; background: var(--bg-secondary); border-radius: 8px; padding: 4px; }
    .tab {
      background: transparent; border: none; border-radius: 6px; padding: 8px 16px;
      font-size: 14px; font-weight: 500; color: var(--text-secondary); cursor: pointer;
      transition: all 0.2s ease; flex: 1; text-align: center;
    }
    .tab.active { background: var(--card-bg); color: var(--text-primary); box-shadow: var(--shadow); }
    .tab.blog.active { color: var(--blog-color); border: 1px solid var(--blog-color); }
    .tab.instagram.active { color: var(--instagram-color); border: 1px solid var(--instagram-color); }
    .tab.facebook.active { color: var(--facebook-color); border: 1px solid var(--facebook-color); }

    .grid { display: grid; gap: 24px; grid-template-columns: 1fr; }
    .card { background: var(--card-bg); border: 1px solid var(--border-light); border-radius: 12px; padding: 24px; box-shadow: var(--shadow); transition: all 0.2s ease; }
    .card:hover { box-shadow: var(--shadow-lg); }
    .card h3 { font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }

    .list { display: flex; flex-direction: column; gap: 8px; }
    .week-title {
      font-weight: 600; font-size: 16px; margin: 16px 0 8px; padding: 12px 16px;
      background: var(--bg-secondary); border-radius: 8px; border-left: 3px solid var(--text-tertiary); color: var(--text-primary);
      border-bottom: 1px solid var(--border-light); /* âœ… ì£¼ì°¨ ë¸”ë¡ êµ¬ë¶„ì„  ì¶”ê°€ */
    }

    .platform-group { margin-bottom: 20px; }
    .platform-header { font-weight: 600; font-size: 16px; margin-bottom: 12px; padding: 12px 16px; border-radius: 8px; color: white; display: flex; align-items: center; gap: 8px; }
    .platform-header.blog { background: var(--blog-color); }
    .platform-header.instagram { background: var(--instagram-color); }
    .platform-header.facebook { background: var(--facebook-color); }

    .item { padding: 12px 16px; border-radius: 8px; background: var(--bg-secondary); border: 1px solid var(--border-light); transition: all 0.2s ease; margin-left: 20px; }
    .item:hover { transform: translateX(4px); box-shadow: var(--shadow); }
    .item a { text-decoration: none; color: var(--text-primary); font-weight: 500; transition: color 0.2s ease; }
    .item a:hover { text-decoration: underline; }
    .item.blog a:hover { color: var(--blog-color); }
    .item.instagram a:hover { color: var(--instagram-color); }
    .item.facebook a:hover { color: var(--facebook-color); }

    /* âœ… ì˜¤ëŠ˜ ë‚ ì§œ ê°•ì¡° */
    .item.today { 
      background: #e6f3ff; 
      border-color: #90caf9; 
      }
    /* âœ… ì˜¤ëŠ˜ ë‚ ì§œ ê°•ì¡° (ë‹¤í¬ëª¨ë“œìš©) */
    [data-theme="dark"] .item.today {
      background: #2d3e50;   /* ì§„í•œ ë‚¨ìƒ‰í†¤ */
      border-color: #64b5f6; /* ë°ì€ íŒŒë‘ */
      }


    .meta { font-size: 12px; color: var(--text-tertiary); margin-top: 4px; display: flex; align-items: center; gap: 8px; }
    .platform-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }

    #platformChart { border-radius: 8px; }

    .empty-state { text-align: center; padding: 40px; color: var(--text-tertiary); }

    .stats-summary {
      background: var(--bg-secondary); border-radius: 8px; padding: 16px; margin-bottom: 20px;
      display: flex; justify-content: space-around; text-align: center;
    }
    .stat-item { flex: 1; }
    .stat-number { font-size: 24px; font-weight: 700; color: var(--text-primary); }
    .stat-label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }

    /* === ì•ˆë‚´ ë¬¸êµ¬, ë°”ë¡œê°€ê¸° ë²„íŠ¼ === */
    .notice { font-size: 14px; color: var(--text-tertiary); margin-top: 4px; }
    .link-buttons { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
    .btn-link {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 12px; border: 1px solid var(--border-light); border-radius: 8px;
      background: var(--card-bg); color: var(--text-primary); text-decoration: none;
      box-shadow: var(--shadow); font-size: 14px;
    }
    .btn-link:hover { transform: translateY(-1px); }
    .btn-blog { border-color: var(--blog-color); }
    .btn-instagram { border-color: var(--instagram-color); }
    .btn-facebook { border-color: var(--facebook-color); }

    /* âœ… í•˜ë‹¨ ë¡œê³  í…ìŠ¤íŠ¸ */
    footer.brand-footer {
      text-align: center;
      margin: 40px 0 12px;
      font-size: 15pt;
      font-weight: 700;
      color: var(--text-secondary);
    }

    /* âœ… í‘¸í„° */
  .footer {
    text-align: center;
    font-size: 20px;
    font-weight: 600;
    color: var(--text-tertiary);
    margin-top: 40px;   /* ë³¸ë¬¸ê³¼ì˜ gap */
    padding: 20px 0;    /* í•˜ë‹¨ ì—¬ë°± */
    border-top: 1px solid var(--border-light); /* êµ¬ë¶„ì„  */
  }
  [data-theme="dark"] .footer {
    border-top: 2px solid var(--border-medium); /* ë‹¤í¬ëª¨ë“œì—ì„œë„ ìì—°ìŠ¤ëŸ½ê²Œ */
  }
    
    
    /* Responsive */
    @media (min-width: 1024px) { .grid { grid-template-columns: 1.5fr 1fr; } }
    @media (max-width: 768px) {
      .container { padding: 16px; }
      header { flex-direction: column; align-items: stretch; text-align: center; }
      .filter-row { flex-direction: column; align-items: stretch; }
      .tabs { flex-direction: column; }
      .item:hover { transform: none; }
      .link-buttons { justify-content: center; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="header-left">
        <h1>ë³´ë‚˜íŒ©í† ë¦¬ SNS ì»¨í…ì¸  ì œì‘ëŒ€í–‰ ë¦¬í¬íŠ¸</h1>

        <p class="notice">
          â€» ì£¼ 3íšŒ ì´ë¯¸ì§€ ì½˜í…ì¸  ì œì‘ <b>í˜ì´ìŠ¤ë¶&ì¸ìŠ¤íƒ€ ë¯¸ëŸ¬ë§</b>  <br>
          â€» <b>ë¸Œëœë”© ë¸”ë¡œê·¸</b> ì›” 10íšŒ ë°œí–‰ ì§„í–‰ì¤‘ (ìƒìœ„ë…¸ì¶œ ë³´ì¥X) <br>
          (ì—…ì²´ì½”ë“œ Bona287 ì„ëŒ€í‘œë‹˜ ì§ì ‘ë‹´ë‹¹ì—…ì²´)
        </p>

        <div class="header-badges">
          <span id="month" class="pill"></span>
          <span id="totals" class="pill"></span>
          <!-- âœ… ìë™ ì—…ë°ì´íŠ¸ ì•ˆë‚´ -->
          <span id="updateTime" class="pill"></span>
        </div>
      </div>
      <button class="theme-toggle" id="themeToggle">
        <span id="theme-icon">ğŸŒ™</span>
        <span id="theme-text">ë‹¤í¬ëª¨ë“œ</span>
      </button>
    </header>

    <!-- í•„í„° ë° íƒ­ ì»¨íŠ¸ë¡¤ -->
    <div class="controls">
      <div class="filter-row">
        <div class="filter-group">
          <label>ë³´ê¸°:</label>
          <select id="viewType" class="filter-select">
            <option value="week">ì£¼ì°¨ë³„</option>
            <option value="month">ì›”ë³„</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ì›”:</label>
          <select id="monthFilter" class="filter-select">
            <option value="">ì „ì²´</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ì£¼ì°¨:</label>
          <select id="weekFilter" class="filter-select">
            <option value="">ì „ì²´</option>
          </select>
        </div>

        <!-- ê¸°ê°„(ë‹¬ë ¥) í•„í„° -->
        <div class="filter-group">
          <label>ê¸°ê°„:</label>
          <input type="date" id="startDate" class="filter-select" />
          ~
          <input type="date" id="endDate" class="filter-select" />
        </div>

        <!-- âœ… ê²€ìƒ‰ì°½ -->
        <div class="filter-group">
          <label>ê²€ìƒ‰:</label>
          <input type="text" id="searchBox" class="search-input" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰ (ì£¼ì œ, í”Œë«í¼)" />
        </div>
      </div>
      
      <div class="tabs">
        <button class="tab active" data-platform="all">ğŸ“Š ì „ì²´</button>
        <button class="tab blog" data-platform="ë¸”ë¡œê·¸">ë¸”ë¡œê·¸</button>
        <button class="tab instagram" data-platform="ì¸ìŠ¤íƒ€">ì¸ìŠ¤íƒ€ê·¸ë¨</button>
        <button class="tab facebook" data-platform="í˜ë¶">í˜ì´ìŠ¤ë¶</button>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <h3 id="contentTitle">ğŸ“ ì „ì²´ ê²Œì‹œë¬¼</h3>
        <div id="statsSummary" class="stats-summary" style="display: none;"></div>
        <div id="weeks" class="list"></div>
      </section>

      <section class="card">
        <h3>ğŸ“Š í”Œë«í¼ë³„ ì§‘ê³„</h3>
        <canvas id="platformChart" height="240"></canvas>

        <!-- í”Œë«í¼ ë°”ë¡œê°€ê¸° ë²„íŠ¼ -->
        <div class="link-buttons">
          <a id="btnBlog" class="btn-link btn-blog" href="#" target="_blank" rel="noopener">ğŸ“ ë¸”ë¡œê·¸ ë°”ë¡œê°€ê¸°</a>
          <a id="btnInsta" class="btn-link btn-instagram" href="#" target="_blank" rel="noopener">ğŸ“· ì¸ìŠ¤íƒ€ ë°”ë¡œê°€ê¸°</a>
          <a id="btnFb"   class="btn-link btn-facebook" href="#" target="_blank" rel="noopener">ğŸ‘¥ í˜ì´ìŠ¤ë¶ ë°”ë¡œê°€ê¸°</a>
        </div>

      </section>
    </div>
  </div>

  <!-- âœ… í•˜ë‹¨ ë¡œê³  í…ìŠ¤íŠ¸ -->
  <!-- âœ… í•˜ë‹¨ í‘¸í„° -->
<footer class="footer">
  <a href="https://nextphoenix.co.kr" target="_blank" rel="noopener" style="text-decoration:none; color:inherit;">
    ë„¥ìŠ¤íŠ¸í”¼ë‹‰ìŠ¤
  </a>
</footer>


  <script>
    // ===== ì„¤ì • =====
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQAZld2-FLleV-GvqjIma-51hpcVmperjx7LlAd79BnN-8Z7-NAoakyf3KVEqeYcaK6Ev83IMc6K7_v/pub?gid=0&single=true&output=csv';
    const COLORS = { 'ë¸”ë¡œê·¸':'#2ecc71', 'ì¸ìŠ¤íƒ€':'#e91e63', 'í˜ë¶':'#3498db' };

    // ===== ì „ì—­ ìƒíƒœ =====
    let allData = [];
    let filteredData = [];
    let currentPlatform = 'all';
    let currentViewType = 'week';
    let chartInstance = null;
    let QUICK_LINKS = { blog:'#', instagram:'#', facebook:'#' };

    // ===== ìœ í‹¸ =====
    function weekOf(dateStr){
      const d = new Date(dateStr);
      const first = new Date(d.getFullYear(), d.getMonth(), 1);
      const diff = Math.floor((d - first)/(1000*60*60*24));
      return Math.floor(diff/7) + 1;
    }
    function todayYMD(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${dd}`;
    }
    const TODAY = todayYMD();

    function groupByWeek(items){
      const map = {};
      items.forEach(it=>{
        const w = weekOf(it.date);
        (map[w] ||= []).push(it);
      });
      return Object.entries(map)
        .sort((a,b)=>a[0]-b[0])
        .map(([w, arr])=>[Number(w), arr.sort((a,b)=>a.date.localeCompare(b.date))]);
    }

    function groupByMonth(items) {
      const map = {};
      items.forEach(item => {
        const month = item.date.slice(0, 7); // YYYY-MM
        (map[month] ||= []).push(item);
      });
      return Object.entries(map).sort((a,b) => a[0].localeCompare(b[0]));
    }

    function calculateCounts(data) {
      const counts = data.reduce((acc, item) => {
        const key = item.platform === 'ë¸”ë¡œê·¸' ? 'blog' : 
                   item.platform === 'ì¸ìŠ¤íƒ€' ? 'instagram' : 'facebook';
        acc[key] = (acc[key] || 0) + 1;
        return acc;
      }, {});
      return { blog: counts.blog || 0, instagram: counts.instagram || 0, facebook: counts.facebook || 0 };
    }

    // ===== ë°ì´í„° ë¡œë“œ =====
    async function fetchRows() {
      const url = CSV_URL + `&cachebust=${Date.now()}`;
      const res = await fetch(url, { cache: 'no-store' });
      const text = await res.text();
      const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
      return parsed.data
        .map(r => ({
          date: (r['ì—…ë¡œë“œë‚ ì§œ'] || '').trim(),
          platform: (r['í”Œë«í¼'] || '').trim(), // 'ë¸”ë¡œê·¸'/'ì¸ìŠ¤íƒ€'/'í˜ë¶'
          title: (r['ì£¼ì œ'] || '').trim(),
          url: (r['ë§í¬'] || '').trim()
        }))
        .filter(x => x.title && x.url && x.date);
    }
    
    // CSV Eì—´(0-index 4) 2~4í–‰(0-index 1..3)ì—ì„œ ë°”ë¡œê°€ê¸° ë§í¬ë¥¼ ì½ëŠ”ë‹¤.
    async function fetchQuickLinks() {
      const url = CSV_URL + `&cachebust=${Date.now()}`;
      const res = await fetch(url, { cache: 'no-store' });
      const text = await res.text();

      // í—¤ë” ì—†ì´ íŒŒì‹±í•´ì„œ í–‰/ì—´ë¡œ ì§ì ‘ ì ‘ê·¼
      const raw = Papa.parse(text, { header: false, skipEmptyLines: true }).data;

      const blog   = (raw[1] && raw[1][4]) ? String(raw[1][4]).trim() : '#'; // E2
      const insta  = (raw[2] && raw[2][4]) ? String(raw[2][4]).trim() : '#'; // E3
      const fb     = (raw[3] && raw[3][4]) ? String(raw[3][4]).trim() : '#'; // E4

      QUICK_LINKS = { blog, instagram: insta, facebook: fb };

      // ë²„íŠ¼ href ì£¼ì…
      const btnBlog = document.getElementById('btnBlog');
      const btnInsta = document.getElementById('btnInsta');
      const btnFb = document.getElementById('btnFb');
      if (btnBlog) btnBlog.href = QUICK_LINKS.blog || '#';
      if (btnInsta) btnInsta.href = QUICK_LINKS.instagram || '#';
      if (btnFb) btnFb.href = QUICK_LINKS.facebook || '#';
    }

    // ===== ë Œë”ë§ =====
    function renderList(grouped){
      const root = document.getElementById('weeks');
      root.innerHTML = '';
      if (grouped.length === 0) {
        root.innerHTML = '<div class="empty-state">ì„ íƒí•œ ì¡°ê±´ì— ë§ëŠ” ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      grouped.forEach(([week, arr])=>{
        const title = document.createElement('div');
        title.className = 'week-title';
        const counts = arr.reduce((acc,it)=>{ acc[it.platform]=(acc[it.platform]||0)+1; return acc; },{});
        title.textContent = `${week}ì£¼ì°¨ (${arr.length}ê±´ / ë¸” ${counts['ë¸”ë¡œê·¸']||0} Â· ì¸ ${counts['ì¸ìŠ¤íƒ€']||0} Â· í˜ ${counts['í˜ë¶']||0})`;
        root.appendChild(title);

        arr.forEach(it=>{
          const row = document.createElement('div');
          const cls = it.platform === 'ë¸”ë¡œê·¸' ? 'blog' : it.platform === 'ì¸ìŠ¤íƒ€' ? 'instagram' : 'facebook';
          const color = COLORS[it.platform] || '#666';
          row.className = `item ${cls}` + (it.date === TODAY ? ' today' : ''); // âœ… ì˜¤ëŠ˜ í‘œì‹œ
          row.innerHTML = `
            <div>
              <span class="platform-dot" style="background:${color};"></span>
              <a href="${it.url}" target="_blank" rel="noopener">${it.title}</a>
            </div>
            <div class="meta">${it.date} Â· ${week}ì£¼ì°¨ Â· ${it.platform}</div>
          `;
          root.appendChild(row);
        });
      });
    }

    function renderListByPlatform(grouped) {
      const root = document.getElementById('weeks');
      root.innerHTML = '';
      if (grouped.length === 0) {
        root.innerHTML = '<div class="empty-state">ì„ íƒí•œ ì¡°ê±´ì— ë§ëŠ” ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      const platformGroups = { 'ë¸”ë¡œê·¸': [], 'ì¸ìŠ¤íƒ€': [], 'í˜ë¶': [] };
      grouped.forEach(([week, arr])=>{
        arr.forEach(item => {
          platformGroups[item.platform]?.push({ ...item, week });
        });
      });

      Object.entries(platformGroups).forEach(([platform, items])=>{
        if (!items.length) return;
        const platformClass = platform === 'ë¸”ë¡œê·¸' ? 'blog' : platform === 'ì¸ìŠ¤íƒ€' ? 'instagram' : 'facebook';
        const platformIcon = platform === 'ë¸”ë¡œê·¸' ? 'ğŸ“' : platform === 'ì¸ìŠ¤íƒ€' ? 'ğŸ“·' : 'ğŸ‘¥';
        const color = COLORS[platform] || '#666';

        const container = document.createElement('div');
        container.className = 'platform-group';
        container.innerHTML = `<div class="platform-header ${platformClass}">${platformIcon} ${platform} (${items.length}ê±´)</div>`;
        items.sort((a,b)=>a.date.localeCompare(b.date));
        items.forEach(item=>{
          const row = document.createElement('div');
          row.className = `item ${platformClass}` + (item.date === TODAY ? ' today' : ''); // âœ… ì˜¤ëŠ˜ í‘œì‹œ
          row.innerHTML = `
            <div>
              <span class="platform-dot" style="background:${color};"></span>
              <a href="${item.url}" target="_blank" rel="noopener">${item.title}</a>
            </div>
            <div class="meta">${item.date} Â· ${item.week}ì£¼ì°¨</div>
          `;
          container.appendChild(row);
        });
        root.appendChild(container);
      });
    }

    function renderMonthList(grouped) {
      const root = document.getElementById('weeks');
      root.innerHTML = '';
      if (grouped.length === 0) {
        root.innerHTML = '<div class="empty-state">ì„ íƒí•œ ì¡°ê±´ì— ë§ëŠ” ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      grouped.forEach(([month, arr])=>{
        const title = document.createElement('div');
        title.className = 'week-title';
        title.textContent = `${month} (${arr.length}ê±´)`;
        root.appendChild(title);

        arr.sort((a,b)=>a.date.localeCompare(b.date));
        arr.forEach(item=>{
          const color = COLORS[item.platform] || '#666';
          const cls = item.platform === 'ë¸”ë¡œê·¸' ? 'blog' : item.platform === 'ì¸ìŠ¤íƒ€' ? 'instagram' : 'facebook';
          const row = document.createElement('div');
          row.className = `item ${cls}` + (item.date === TODAY ? ' today' : ''); // âœ… ì˜¤ëŠ˜ í‘œì‹œ
          row.innerHTML = `
            <div>
              <span class="platform-dot" style="background:${color};"></span>
              <a href="${item.url}" target="_blank" rel="noopener">${item.title}</a>
            </div>
            <div class="meta">${item.date} Â· ${item.platform}</div>
          `;
          root.appendChild(row);
        });
      });
    }

    // ìƒë‹¨ ìš”ì•½/ë°°ì§€, ì°¨íŠ¸
    function renderTotals(items){
      const counts = items.reduce((acc, it)=>{
        acc[it.platform] = (acc[it.platform]||0)+1;
        return acc;
      }, {});
      const blog = counts['ë¸”ë¡œê·¸']||0, insta = counts['ì¸ìŠ¤íƒ€']||0, fb = counts['í˜ë¶']||0;
      document.getElementById('totals').textContent = `ì´ ${blog+insta+fb}ê±´`;

      const m = items.map(x=> (x.date||'').slice(0,7)).filter(Boolean).sort().pop();
      document.getElementById('month').textContent = m || '';

      // í†µê³„ ì¹´ë“œ (ì „ì²´ íƒ­ì¼ ë•Œë§Œ)
      const stats = document.getElementById('statsSummary');
      if (currentPlatform === 'all' && (blog+insta+fb)>0) {
        stats.style.display = 'flex';
        stats.innerHTML = `
          <div class="stat-item"><div class="stat-number" style="color: var(--blog-color)">${blog}</div><div class="stat-label">ë¸”ë¡œê·¸</div></div>
          <div class="stat-item"><div class="stat-number" style="color: var(--instagram-color)">${insta}</div><div class="stat-label">ì¸ìŠ¤íƒ€ê·¸ë¨</div></div>
          <div class="stat-item"><div class="stat-number" style="color: var(--facebook-color)">${fb}</div><div class="stat-label">í˜ì´ìŠ¤ë¶</div></div>
        `;
      } else {
        stats.style.display = 'none';
      }
      return { blog, instagram: insta, facebook: fb };
    }

    function renderChart(counts){
      const ctx = document.getElementById('platformChart');
      const labels = ['ë¸”ë¡œê·¸','ì¸ìŠ¤íƒ€','í˜ë¶'];
      const data = [counts.blog||0, counts.instagram||0, counts.facebook||0];
      const bg = ['#2ecc71','#e91e63','#3498db']; // âœ… í”Œë«í¼ë³„ ìƒ‰

      if (chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx, {
        type: 'bar',
        data: { 
          labels, 
          datasets: [{ 
            label:'ê²Œì‹œë¬¼ ìˆ˜', 
            data, 
            backgroundColor: bg 
          }] 
        },
        options: { 
          responsive:true, 
          plugins:{legend:{display:false}}, 
          scales:{y:{beginAtZero:true, ticks:{precision:0}}} 
        }
      });
    }


    // ===== í•„í„°/íƒ­/í…Œë§ˆ =====
    function updateFilterOptions(data) {
      const months = [...new Set(data.map(item => item.date.slice(0, 7)))].sort();
      const monthSelect = document.getElementById('monthFilter');
      monthSelect.innerHTML = '<option value="">ì „ì²´</option>';
      months.forEach(month => monthSelect.innerHTML += `<option value="${month}">${month}</option>`);
      const weeks = [...new Set(data.map(item => weekOf(item.date)))].sort((a,b)=>a-b);
      const weekSelect = document.getElementById('weekFilter');
      weekSelect.innerHTML = '<option value="">ì „ì²´</option>';
      weeks.forEach(week => weekSelect.innerHTML += `<option value="${week}">${week}ì£¼ì°¨</option>`);
    }

    function applyFilters() {
      currentViewType = document.getElementById('viewType').value;
      const selectedMonth = document.getElementById('monthFilter').value;
      const selectedWeek = document.getElementById('weekFilter').value;

      // ë‚ ì§œ ë²”ìœ„ ê°’
      const start = document.getElementById('startDate').value; // YYYY-MM-DD
      const end   = document.getElementById('endDate').value;   // YYYY-MM-DD

      // âœ… ê²€ìƒ‰ì–´
      const keyword = (document.getElementById('searchBox').value || '').trim().toLowerCase();

      let data = (currentPlatform === 'all') ? [...allData] : allData.filter(d => d.platform === currentPlatform);
      if (selectedMonth) data = data.filter(d => d.date.startsWith(selectedMonth));
      if (selectedWeek)  data = data.filter(d => weekOf(d.date) == selectedWeek);

      // ë‚ ì§œ ë²”ìœ„ í•„í„° (YYYY-MM-DD ë¬¸ìì—´ ë¹„êµ)
      if (start) data = data.filter(d => d.date >= start);
      if (end)   data = data.filter(d => d.date <= end);

      // âœ… í‚¤ì›Œë“œ í•„í„° (ì£¼ì œ/í”Œë«í¼/URL)
      if (keyword) {
        data = data.filter(d => 
          (d.title || '').toLowerCase().includes(keyword) ||
          (d.platform || '').toLowerCase().includes(keyword) ||
          (d.url || '').toLowerCase().includes(keyword)
        );
      }

      filteredData = data;

      if (currentViewType === 'week') {
        if (currentPlatform === 'all') renderList(groupByWeek(data));
        else renderListByPlatform(groupByWeek(data));
      } else {
        const grouped = groupByMonth(data);
        renderMonthList(grouped);
      }

      const counts = renderTotals(data);
      renderChart(counts);
    }

    function switchPlatform(platform, buttonEl) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      buttonEl.classList.add('active');
      currentPlatform = platform;
      const titleMap = { 'all':'ğŸ“Š ì „ì²´', 'ë¸”ë¡œê·¸':'ğŸ“ ë¸”ë¡œê·¸', 'ì¸ìŠ¤íƒ€':'ğŸ“· ì¸ìŠ¤íƒ€ê·¸ë¨', 'í˜ë¶':'ğŸ‘¥ í˜ì´ìŠ¤ë¶' };
      document.getElementById('contentTitle').textContent = `${titleMap[platform]} ê²Œì‹œë¬¼`;
      applyFilters();
    }

    function bindUI() {
      // í…Œë§ˆ í† ê¸€
      const toggleBtn = document.getElementById('themeToggle');
      toggleBtn.addEventListener('click', ()=>{
        const body = document.body;
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');
        if (body.getAttribute('data-theme') === 'dark') {
          body.removeAttribute('data-theme'); themeIcon.textContent = 'ğŸŒ™'; themeText.textContent = 'ë‹¤í¬ëª¨ë“œ'; localStorage.setItem('theme','light');
        } else {
          body.setAttribute('data-theme','dark'); themeIcon.textContent = 'â˜€ï¸'; themeText.textContent = 'ë¼ì´íŠ¸ëª¨ë“œ'; localStorage.setItem('theme','dark');
        }
        if (chartInstance) { chartInstance.destroy(); renderChart(calculateCounts(filteredData)); }
      });

      // ì €ì¥ëœ í…Œë§ˆ ë³µì›
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') {
        document.body.setAttribute('data-theme','dark');
        document.getElementById('theme-icon').textContent = 'â˜€ï¸';
        document.getElementById('theme-text').textContent = 'ë¼ì´íŠ¸ëª¨ë“œ';
      }

      // ì…€ë ‰íŠ¸/ì…ë ¥ ë³€ê²½
      document.getElementById('viewType').addEventListener('change', applyFilters);
      document.getElementById('monthFilter').addEventListener('change', applyFilters);
      document.getElementById('weekFilter').addEventListener('change', applyFilters);
      document.getElementById('startDate').addEventListener('change', applyFilters);
      document.getElementById('endDate').addEventListener('change', applyFilters);
      document.getElementById('searchBox').addEventListener('input', applyFilters);

      // íƒ­
      document.querySelectorAll('.tab').forEach(btn=>{
        btn.addEventListener('click', ()=> switchPlatform(btn.dataset.platform, btn));
      });
    }

    function setUpdateTime(){
      const el = document.getElementById('updateTime');
      if (el) el.textContent = 'ì—…ë°ì´íŠ¸: ' + new Date().toLocaleString('ko-KR');
    }

    // ===== ë¶€íŠ¸ìŠ¤íŠ¸ë© =====
    (async ()=>{
      bindUI();
      allData = await fetchRows();
      await fetchQuickLinks();          // CSV E2~E4 ë§í¬ ì½ì–´ì™€ ë²„íŠ¼ì— ì£¼ì…
      updateFilterOptions(allData);
      setUpdateTime();                  // âœ… ìë™ ì—…ë°ì´íŠ¸ í‘œì‹œ
      applyFilters();                   // ì´ˆê¸° ë Œë”
    })();

    
  </script>
</body>
</html>
